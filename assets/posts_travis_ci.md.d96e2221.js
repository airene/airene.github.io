import{_ as l,o as p,c as e,d as s,e as o,t,a as r,f as c,r as i}from"./app.ca59a66d.js";const g=JSON.parse('{"title":"travis_ci 自动部署 vitepress","description":"这个是vitepress官方的配置加了些优化，主要是能提升构建速度","frontmatter":{"date":"2021-07-04T00:00:00.000Z","title":"travis_ci 自动部署 vitepress","tags":["travis"],"description":"这个是vitepress官方的配置加了些优化，主要是能提升构建速度"},"headers":[{"level":2,"title":"配置","slug":"配置","link":"#配置","children":[]},{"level":2,"title":"几个注意点","slug":"几个注意点","link":"#几个注意点","children":[]}],"relativePath":"posts/travis_ci.md"}'),y={name:"posts/travis_ci.md"},D={id:"frontmatter-title",tabindex:"-1"},C=s("a",{class:"header-anchor",href:"#frontmatter-title","aria-hidden":"true"},"#",-1),F=c(`<p>这个是vitepress官方的配置加了些优化，主要是能提升构建速度</p><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-hidden="true">#</a></h2><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">language</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node_js</span></span>
<span class="line"><span style="color:#F07178;">node_js</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lts/*</span></span>
<span class="line"><span style="color:#F07178;">install</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn install</span></span>
<span class="line"><span style="color:#F07178;">script</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yarn build</span></span>
<span class="line"><span style="color:#F07178;">branches</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">only</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#F07178;">deploy</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">provider</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pages</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">skip_cleanup</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">local_dir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.vitepress/dist</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">github_token</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">$travis_ci</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">keep_history</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FF9CAC;">on</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">branch</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">master</span></span>
<span class="line"><span style="color:#F07178;">cache</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">apt</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">yarn</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">directories</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node_modules</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><p>其实以上配置忽略了一个重要的配置信息就是target_branch，默认是gh-pages,也就是自动提交到本工程的这个分支。一开始以为是和deploy.sh一套配合使用的，想推到哪里推哪里，其实就这个yml文件就够了，花了不少时间总是构建成功，部署不成功。具体travis支持的所有配置项 <a href="https://docs.travis-ci.com/user/deployment/pages/" target="_blank" rel="noreferrer">github pages config</a></p><p>正常用户的情况应该就一个网站，而且希望域名是短的，比如 <code>xxx.github.io</code> 而不是再增加一个/repo/，变成 <code>xxx.github.io/repo/</code></p><p>GitHub pages 对这两个的支持都很好了，用前者的话，一般还会加一个自定义的域名，https成熟，域名现在很多也不贵。</p><h2 id="几个注意点" tabindex="-1">几个注意点 <a class="header-anchor" href="#几个注意点" aria-hidden="true">#</a></h2><ul><li>$travis_ci变量的值是在github平台生成的token，在github随便起名字自己记忆用的，权限也不用开太大，但是变量名是要和travis_ci官网的environment一致，也就是在travis网站上填的是 travis_ci</li><li>travis 有10000的构建信用分，用完了不知道会怎么样，也是为了体验，实际上用完了可以切换到github action</li><li>如果需要绑定域名而且是apex型，顶域名，而不是二级域名， 也就是 <code>xxx.xxx</code> or <code>www.xxx.xxx</code> 单独加cname好像还不行，验证不了，还需要加到 Github pages的A记录才能顺利验证，本来生效就慢，配置完如果没问题，可以过几个小时再回来看</li><li>怎么配置travis, GitHub token网上好的文章一大堆就没必要写了</li></ul>`,8);function A(a,d,_,h,u,v){const n=i("Comment");return p(),e("div",null,[s("h1",D,[o(t(a.$frontmatter.title)+" ",1),C]),F,r(n)])}const x=l(y,[["render",A]]);export{g as __pageData,x as default};
